<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmail Email Cleanmail - Local Gmail Aggregation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">
        <span id="theme-icon">ðŸŒ™</span>
    </button>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <header>
        <h1>Gmail Email Cleanmail</h1>
        <p class="subtitle">Local Gmail aggregation - your data never leaves your machine</p>
    </header>

    <main>
        <!-- Accounts Section -->
        <section id="accounts-section" class="card">
            <h2>Connected Accounts</h2>
            <div id="accounts-list">
                {% if accounts %}
                    {% for account in accounts %}
                    <div class="account-item" data-account-id="{{ account.id }}">
                        <span class="account-email">{{ account.email or account.id }}</span>
                        <span class="account-status {{ 'connected' if account.authenticated else 'disconnected' }}">
                            {{ 'Connected' if account.authenticated else 'Disconnected' }}
                        </span>
                        <button class="btn btn-small btn-danger" onclick="removeAccount('{{ account.id }}')">Remove</button>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="no-accounts">No accounts connected yet.</p>
                {% endif %}
            </div>
            <button id="add-account-btn" class="btn btn-primary" onclick="addAccount()">
                + Add Gmail Account
            </button>
        </section>

        <!-- Scan Controls -->
        <section id="scan-section" class="card">
            <h2>Scan Emails</h2>
            <div class="scan-controls">
                <div class="form-group">
                    <label for="query-filter">Filter (optional):</label>
                    <input type="text" id="query-filter" placeholder="e.g., is:unread, category:promotions">
                </div>
                <button id="scan-btn" class="btn btn-primary" onclick="startScan()">
                    Scan All Emails
                </button>
            </div>
            <div id="scan-progress" class="progress-container" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p id="progress-text">Scanning...</p>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results-section" class="card" style="display: none;">
            <h2>Results</h2>

            <!-- Results Toolbar -->
            <div class="results-toolbar">
                <div class="view-toggle">
                    <button class="btn view-btn active" data-view="senders" onclick="switchView('senders')">
                        By Sender
                    </button>
                    <button class="btn view-btn" data-view="domains" onclick="switchView('domains')">
                        By Domain
                    </button>
                </div>

                <div class="search-box">
                    <input type="text" id="results-search" placeholder="Search results..." oninput="filterResults()">
                </div>

                <select class="sort-select" id="sort-select" onchange="sortResults()">
                    <option value="count-desc">Most emails first</option>
                    <option value="count-asc">Fewest emails first</option>
                    <option value="size-desc">Largest size first</option>
                    <option value="size-asc">Smallest size first</option>
                    <option value="name-asc">Name A-Z</option>
                    <option value="name-desc">Name Z-A</option>
                </select>

                <select class="sort-select" id="age-filter" onchange="filterByAge()">
                    <option value="all">All Ages</option>
                </select>

                <div class="toolbar-actions">
                    <button class="btn btn-secondary btn-small" onclick="exportCSV()">
                        Export CSV
                    </button>
                </div>
            </div>

            <div id="results-container"></div>
        </section>
    </main>

    <!-- Modal for sender details -->
    <div id="detail-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Confirmation modal -->
    <div id="confirm-modal" class="modal" style="display: none;">
        <div class="modal-content modal-small">
            <h3 id="confirm-title">Confirm Action</h3>
            <p id="confirm-message"></p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn btn-danger" id="confirm-action-btn">Confirm</button>
            </div>
        </div>
    </div>

    <footer>
        <p>All data is processed and stored locally on your machine. No data is ever sent to external servers.</p>
    </footer>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
